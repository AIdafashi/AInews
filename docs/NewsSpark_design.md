# AI 新闻聚合与选题助手（代号：NewsSpark）产品设计文档

> **面向角色** ：AI 科技自媒体博主 AI大法师 及其内容创作团队
> **版本** ：v1.0 (2025-06-07)
> **撰写目的** ：提供一份完整、清晰、详尽的产品方案，便于产品经理、设计师与开发团队快速对齐并落地实现。

---

## 目录

1. 背景与目标
2. 关键用例概述
3. 功能需求
4. 非功能需求
5. 系统架构与技术选型
6. 数据处理流程
7. 去重与推送策略
8. 前端页面与交互设计
9. 飞书多维表格选题库集成
10. API 设计草案
11. 数据模型 & 数据库设计
12. 运维与监控
13. 安全与隐私
14. 开发计划与里程碑
15. 未来扩展与优化方向

---

## 1. 背景与目标

* **痛点** ：AI 科技新闻更新快、信息源分散，难以及时获知；重复报道多，人工筛选耗时；选题管理分散，缺乏一键归档与后续跟踪。
* **目标** ：

  1. 10 分钟内捕获全球主流渠道的 AI 科技动向并摘要推送。
  2. 避免重复内容二次推送，减少信息噪音 ≥ 80%。
  3. 提供可视化新闻面板，支持一键加入选题库（飞书多维表格）。
  4. 未来支持多平台（Web、移动端、飞书小程序）访问。

## 2. 关键用例概述

| # | 场景 | 参与者 | 前置条件 | 主流程 | 后置结果 |
| --- | --- | --- | --- | --- | --- |
| UC-01 | 新闻聚合与去重 | 定时任务 / 手动刷新 | 配置好数据源 | 抓取→清洗→去重→入库 | 新增新闻写入 DB & 待推送队列 |
| UC-02 | 实时推送 | 系统→用户 | 用户订阅 & Token 有效 | 按策略推送摘要消息 | 用户收到推送 |
| UC-03 | 浏览每日新闻 | 用户 | 登录成功 | 加载新闻列表 | 查看详情 / 标记已读 |
| UC-04 | 加入选题库 | 用户 | 已选中新闻 | 点击 "加入选题" 按钮 | 新闻摘要同步到飞书多维表格 |

## 3. 功能需求

### 3.1 新闻抓取

* **多源聚合**：NewsAPI、HackerNews API、ArXiv RSS、官方博客、Twitter/X、Reddit、Product Hunt、Github release feed…
* **可配置**：支持用户自定义关键词、域名白名单 / 黑名单。
* **时间窗口**：增量拉取，默认 15min 轮询，可调。

### 3.2 数据清洗

* HTML → Markdown；抽取标题、正文、作者、发布时间、来源域名、原文链接。
* 调用 LLM 生成 150 字中文摘要 + 3-5 关键词标签。

### 3.3 去重逻辑

1. 计算 **内容指纹**：`SHA256(title + source_domain + publish_date)`
2. 若指纹已存在 & 发布时间距上次推送 < 24h → 丢弃。
3. 对相似标题（余弦相似度 > 0.9）做软去重，仅保留最早版本；其余版本标记为 `duplicate_link`。

### 3.4 推送中心

* **渠道**：① 飞书机器人（群聊 / 私聊）② 邮件 ③ Web Push（Service Worker）
* **触发**：

  * 定时批量推送（默认每 1h 整点）
  * 用户手动刷新 → 立即推送新增
* **推送内容**：标题 + 来源 + 发布时间 + 摘要 + 快捷按钮（加入选题 ｜ 查看原文）。

### 3.5 前端面板

* 当日新闻瀑布流 / 卡片视图；日期切换；标签筛选；搜索；已读 / 未读。
* 每条卡片：来源 Favicon、标题、标签、发布时间、摘要、[加入选题] 按钮。
* 顶部刷新按钮：手动触发抓取任务。

### 3.6 选题库同步

* 点击按钮 → 调用后端接口 → 调用飞书多维表格 OpenAPI（写入一行记录）。
* 字段映射：标题｜摘要｜标签｜发布时间｜来源｜原文链接｜创建人｜状态="未开始"。

### 3.7 管理后台（可选 V2）

* 数据源配置、抓取日志、去重命中率、推送统计、API Token 管理。

## 4. 非功能需求

| 分类 | 指标 |
| --- | --- |
| **时效性** | 新新闻捕获 ≤ 10 min；推送延迟 ≤ 2 min |
| **可用性** | 99.5% 月可用；故障自恢复 |
| **扩展性** | 数据源插件化；支持水平扩容 |
| **安全** | OAuth2 + JWT；HTTPS 全链路加密 |
| **国际化** | 默认中文；可拓展多语言 UI |

## 5. 系统架构与技术选型

```
┌────────┐     ┌──────────┐     ┌────────────┐
│数据源 1 │ →  │抓取 Worker│ →  │消息队列 Kafka│
└────────┘     └──────────┘     └──────┬─────┘
        …                  …            │      
┌────────┐     ┌──────────┐     ┌──────▼─────┐
│数据源 N │ →  │清洗/去重  │ →  │ Postgres   │
└────────┘     └──────────┘     └──────┬─────┘
                                        │
                         ┌──────────────┴──────────────┐
                         │   推送服务 (FastAPI)         │
                         └──────┬──────────┬────────────┘
                                │          │
            ┌───────────────────┘          └────────────────┐
            ▼                                          ▼    
   前端 Web SPA (Next.js)                      飞书机器人推送
```

* **后端框架**：Python FastAPI + Celery (or Airflow) + PostgreSQL + Redis。
* **爬虫 / 抓取**：Requests + feedparser；特殊源用 Playwright 无头浏览器。
* **消息队列**：Kafka（高吞吐）或 RabbitMQ（易部署）。
* **LLM 摘要**：调用 OpenAI o3 或 Qwen2；缓存至 Redis。
* **部署**：Docker Compose → k8s；CI/CD 使用 GitHub Actions。
* **日志**：ELK 或 Grafana Loki；监控 Prometheus + Alertmanager。

## 6. 数据处理流程

1. **Scheduler** 每 15 min 生成抓取任务。
2. **Fetcher Worker** 并发拉取源内容 → 写原始表 `raw_news`。
3. **Cleaner** 解析正文、摘要 → 计算指纹。
4. **Deduplicator** 依据指纹 / 相似度去重 → 写入 `news` 表。
5. **Notifier** 监听 `news` 表增量 → 推送队列。
6. **Pusher** 根据用户订阅策略发送。

## 7. 去重与推送策略

```pseudocode
if fingerprint in fingerprint_set and now-publish_time < 24h:
    skip_push()
else:
    push()
    fingerprint_set.add(fingerprint)
```

* **防炸群**：单次批量 ≤ 5 条，余量延后。
* **优先级**：官方博客 > 论文预印本 > 社区讨论。

## 8. 前端页面与交互设计

### 8.1 主要页面

1. **Dashboard /news**

   * 日期选择器（默认今日）
   * 新闻卡片列表（无限滚动）
   * 顶部浮动刷新按钮
2. **Settings**

   * 数据源、关键词、推送方式、推送时间段
3. **Admin (可选)**

   * 抓取统计、系统健康

### 8.2 卡片组件

```
┌───────────────────────────────────────────┐
│[Favicon] 【来源】标题                    ⏰ 08:43│
│摘要：LLM 一句话概述…（折叠）              │
│标签：#LLM  #OpenAI  #模型发布             │
│[加入选题]   [原文链接]                   │
└───────────────────────────────────────────┘
```

## 9. 飞书多维表格选题库集成

* **前提**：获取飞书开放平台 AppID & AppSecret，申请多维表格权限 `bitable:app`。
* **步骤**：

  1. 后端调用 `auth/v3/app_access_token/internal/` 获取 token。
  2. `POST /bitable/v1/apps/{app_token}/tables/{table_id}/records` 写入记录。
* **回写字段**：`status` 字段随着内容进度更新（未开始 → 脚本撰写 → 已发布）。

## 10. API 设计草案

| Method | Endpoint | 描述 | 权限 |
| --- | --- | --- | --- |
| GET | /api/news?date=2025-06-07 | 获取当日新闻列表 | 登录用户 |
| POST | /api/news/refresh | 手动拉取 | 登录用户 |
| POST | /api/topics | 将新闻加入选题库 | 登录用户 |
| GET | /api/settings | 获取用户设置 | 登录用户 |
| PUT | /api/settings | 更新用户设置 | 登录用户 |

### `/api/topics` Request Body

```json
{
  "news_id": "9f2e…",
  "comment": "可作为短视频选题，侧重比较 xxx"
}
```

## 11. 数据模型 & 数据库设计

```sql
-- 新闻主表
CREATE TABLE news (
  id UUID PRIMARY KEY,
  title TEXT NOT NULL,
  summary TEXT,
  content TEXT,
  url TEXT,
  source_domain TEXT,
  publish_time TIMESTAMP,
  tags TEXT[],
  fingerprint CHAR(64),
  created_at TIMESTAMP DEFAULT now()
);

CREATE UNIQUE INDEX idx_news_fp ON news(fingerprint);
```

* 另附 `raw_news`、`push_log`、`user_settings`、`topic_bindings` 表。

## 12. 运维与监控

* **CI/CD**：GitHub Actions → Docker Hub → k8s Rolling Update。
* **监控项**：抓取成功率、推送成功率、去重命中率、延迟、容器 CPU/内存。
* **告警**：关键流程失败、延迟 > 15 min 时飞书告警。

## 13. 安全与隐私

* OAuth2 登录（支持飞书 & Google）。
* AES-256 加密存储第三方 API 密钥。
* 最小权限原则，细分 RBAC（普通用户 / 管理员）。

## 14. 开发计划与里程碑

| Sprint | 时长 | 里程碑 | 主要交付 |
| --- | --- | --- | --- |
| 0 | 1w | 环境 & 原型 | 抓取 PoC、前端 UI 初稿 |
| 1 | 2w | 核心功能 | 抓取 + 去重 + 推送 MVP |
| 2 | 2w | 选题库集成 | 飞书多维表格写入 & UI 按钮 |
| 3 | 2w | QA & 部署 | 安全加固、监控、正式发布 |

## 15. 未来扩展与优化方向

* **智能推荐**：根据阅读/点击记录做兴趣建模。
* **多语言摘要**：一键生成英文稿件。
* **语音播报**：TTS 每日播报。
* **移动端 App**：Flutter / React Native。
* **用户生成数据源**：开放爬虫插件市场。

---

> 如需进一步细化任何部分，请在本文档中直接批注或在飞书中 @产品经理 / @开发负责人。
